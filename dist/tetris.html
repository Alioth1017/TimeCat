<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="renderer" content="webkit">
    <meta name="description" content="Tetris" />
    <meta name="keywords" content="Tetris">
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta charset="UTF-8">
    <title>Tetris</title>
    <link href="https://chvin.github.io/react-tetris/loader.css" rel="stylesheet" />
    <link href="https://chvin.github.io/react-tetris/css-1.0.1.css" rel="stylesheet">
    <style>
        [v-cloak] {
            display: none;
        }

        .todo-list li .destroy {
            display: block !important;
        }

        #replay {
            border: 1px solid grey;
            padding: 5px 10px;
            font-size: 22px;
            color: red;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            left: 0;
        }

        #replay.locked {
            color: rgb(205, 203, 203);
            border-color: rgb(205, 203, 203);
        }


        #replay.hide {
            visibility: hidden;
        }
    </style>
</head>

<body>
    <a style="position: absolute; z-index: 100; right: 0" href="https://github.com/oct16/WebReplay">
        <img width="100" height="100"
            src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149"
            alt="Fork me on GitHub" />
    </a>
    <div id="root">
        <div class="load">
            <div class="loader">Loading...</div>
        </div>
    </div>
    <button id="replay" class="locked">Replay</button>
    <script type="text/javascript" src="https://chvin.github.io/react-tetris/app-1.0.1.js"></script>
    <script id="web-replay" src="./replay.min.js"></script>

    <script>
        setTimeout(() => {
            const { record, DB } = wr
            DB.then(db => {
                db.clear()
                const ctr = record({
                    emitter: data => {
                        db.add(data)
                    }
                })

                handleReplay(ctr)
            })
        }, 1000)

        function handleReplay(ctr) {
            function IsPC() {
                var userAgentInfo = navigator.userAgent;
                var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
                var flag = true;
                for (var v = 0; v < Agents.length; v++) {
                    if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
                }
                return flag;
            }
            const replayButton = document.getElementById('replay')
            setTimeout(() => {
                replayButton.className = ''
            }, 5000);
            document.addEventListener(IsPC() ? 'click' : 'touchstart', e => {
                if (e.target === replayButton) {
                    if (replayButton.className) {
                        return
                    }
                    replayButton.className = 'hide'
                    ctr.uninstall()
                    if (IsPC()) {
                        window.open('replay.html')
                    } else {
                        location.href = './replay.html'
                    }
                }
            })
        }
    </script>

    <script>
        const root = document.getElementById('root')
        const iframeNodes = root.getElementsByTagName('iframe')
        const qr = root.querySelector('img[alt="二维码"]')
            ;[qr, ...iframeNodes].forEach(node => {
                if (node) {
                    node.parentElement.removeChild(node)
                }
            })
    </script>

    <!--env-->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151180797-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-151180797-1');
    </script>
    <!--env-->
</body>

</html>
